generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  archivedAt    DateTime? @map("archived_at")
  name          String?
  email         String?   @unique
  emailVerified DateTime? @map("email_verified")
  image         String?

  accounts    Account[]
  sessions    Session[]
  avatar      UserAvatar?
  memberships ImplementerMember[]
  recentOpens UserRecentOpen[]

  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String  @map("user_id")
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique @map("session_token")
  expires      DateTime
  userId       String   @map("user_id")
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model Implementer {
  id                 String              @id @db.VarChar(255)
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  archivedAt         DateTime?           @map("archived_at")
  visibleId          String              @unique @map("visible_id") @db.VarChar(100) // e.g. Imp_1
  implementerName    String              @map("implementer_name")
  implementerType    String              @map("implementer_type") // e.g. NGO
  implementerAddress String?             @map("implementer_address") // e.g. MAWEHSI GARDENS, OFF Matumbato Rd, Nairobi
  countyOfOperation  String?             @map("county_of_operation") // e.g. Makueni
  pointPersonName    String?             @map("point_person_name") // e.g. Beverly
  pointPersonPhone   String?             @map("point_person_phone") // e.g. 0712345678
  pointPersonEmail   String?             @map("point_person_email") // e.g. timothy@amhrtf.org
  avatar             ImplementerAvatar?
  memberships        ImplementerMember[]
  invites            ImplementerInvite[]
  fellows            Fellow[]
  hubs               Hub[]
  hubCoordinators    HubCoordinator[]
  schools            School[]
  supervisors        Supervisor[]
  students           Student[]
  studentOutcomes    StudentOutcome[]
  projects           Projects[]

  @@map("implementers")
}

model ImplementerAvatar {
  id            String      @id @db.VarChar(255)
  implementerId String      @unique @map("implementer_id")
  implementer   Implementer @relation(fields: [implementerId], references: [id])
  fileId        String      @unique @map("file_id")
  file          File        @relation(fields: [fileId], references: [id])

  @@map("implementer_avatars")
}

model File {
  id                String             @id @db.VarChar(255)
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")
  archivedAt        DateTime?          @map("archived_at")
  key               String             @map("key")
  fileName          String             @map("file_name")
  byteSize          Int                @map("byte_size")
  contentType       String             @map("content_type")
  width             Int?
  height            Int?
  signedUrl         String?            @map("signed_url") @db.VarChar(2048)
  expiresAt         DateTime?          @map("expires_at")
  implementerAvatar ImplementerAvatar?
  userAvatar        UserAvatar?

  @@map("files")
}

model UserRecentOpen {
  id       Int      @id @default(autoincrement())
  userId   String   @map("user_id") @db.VarChar(255)
  user     User     @relation(fields: [userId], references: [id])
  itemId   String   @map("item_id") // TODO: itemId leverages object ids (e.g. school_01hbnsp5eserr939h1v6s1ty5r) and polymorphic associations
  openedAt DateTime @default(now()) @map("opened_at")

  @@index([userId, itemId])
  @@map("user_recent_opens")
}

model UserAvatar {
  id     String @id @db.VarChar(255)
  userId String @unique @map("user_id")
  user   User   @relation(fields: [userId], references: [id])
  fileId String @unique @map("file_id")
  file   File   @relation(fields: [fileId], references: [id])

  @@map("user_avatars")
}

enum ImplementerRole {
  ADMIN
  HUB_COORDINATOR
  SUPERVISOR
  OPERATIONS

  @@map("implementer_roles")
}

model ImplementerMember {
  id            Int             @id @default(autoincrement())
  implementerId String          @map("implementer_id") @db.VarChar(255)
  implementer   Implementer     @relation(fields: [implementerId], references: [id])
  userId        String          @map("user_id") @db.VarChar(255)
  user          User            @relation(fields: [userId], references: [id])
  role          ImplementerRole
  identifier    String?         @db.VarChar(255) // object ids which can represent either supervisors, HCs, etc e.g. sup_XXXXX, coord_YYYYY

  @@map("implementer_members")
}

model ImplementerInvite {
  id              Int             @id @default(autoincrement())
  email           String
  implementerId   String          @map("implementer_id") @db.VarChar(255)
  implementer     Implementer     @relation(fields: [implementerId], references: [id])
  implementerRole ImplementerRole @map("implementer_role")
  sentAt          DateTime        @default(now()) @map("sent_at")
  expiresAt       DateTime        @map("expires_at")
  acceptedAt      DateTime?       @map("accepted_at")
  secureToken     String          @map("secure_token")

  @@unique([email, implementerId, secureToken])
  @@map("implementer_invites")
}

model Student {
  id                   String                  @id @db.VarChar(255)
  createdAt            DateTime                @default(now()) @map("created_at")
  updatedAt            DateTime                @updatedAt @map("updated_at")
  archivedAt           DateTime?               @map("archived_at")
  studentName          String?                 @map("student_name") @db.VarChar(255)
  visibleId            String                  @unique @map("visible_id") @db.VarChar(100)
  fellowId             String?                 @map("fellow_id") @db.VarChar(255) // TODO: we may need to remove this, intervention_group_sessions.leader_id is more reliable
  fellow               Fellow?                 @relation(fields: [fellowId], references: [id])
  supervisorId         String?                 @map("supervisor_id") @db.VarChar(255)
  supervisor           Supervisor?             @relation(fields: [supervisorId], references: [id])
  implementerId        String?                 @map("implementer_id") @db.VarChar(255)
  implementer          Implementer?            @relation(fields: [implementerId], references: [id])
  schoolId             String?                 @map("school_id") @db.VarChar(255)
  school               School?                 @relation(fields: [schoolId], references: [id])
  yearOfImplementation Int?                    @map("year_of_implementation") // might not be needed any more
  admissionNumber      String?                 @map("admission_number") @db.VarChar(255)
  age                  Int?
  gender               String?                 @db.VarChar(10)
  form                 Int?
  stream               String?                 @db.VarChar(255)
  condition            String?                 @db.VarChar(255)
  intervention         String?                 @db.VarChar(255)
  tribe                String?                 @db.VarChar(255)
  county               String?                 @db.VarChar(255)
  financialStatus      String?                 @map("financial_status") @db.VarChar(255)
  home                 String?                 @db.VarChar(255)
  siblings             String?                 @db.VarChar(255)
  religion             String?                 @db.VarChar(255)
  groupName            String?                 @map("group_name") @db.VarChar(255) // TODO: move to intervention_groups & intervention_group_students table
  survivingParents     String?                 @map("surviving_parents") @db.VarChar(255)
  parentsDead          String?                 @map("parents_dead") @db.VarChar(255)
  fathersEducation     String?                 @map("fathers_education") @db.VarChar(255)
  mothersEducation     String?                 @map("mothers_education") @db.VarChar(255)
  coCurricular         String?                 @map("co_curricular") @db.VarChar(255)
  sports               String?                 @db.VarChar(255)
  isClinicalCase       Boolean?                @map("is_clinical_case")
  phoneNumber          String?                 @map("phone_number") @db.VarChar(255)
  mpesaNumber          String?                 @map("mpesa_number") @db.VarChar(255)
  attendanceSession0   Boolean?                @map("attendance_session_0")
  attendanceSession1   Boolean?                @map("attendance_session_1")
  attendanceSession2   Boolean?                @map("attendance_session_2")
  attendanceSession3   Boolean?                @map("attendance_session_3")
  attendanceSession4   Boolean?                @map("attendance_session_4")
  droppedOut           Boolean?                @map("dropped_out")
  droppedOutAt         DateTime?               @map("dropped_out_at") @db.Timestamptz()
  dropOutReason        String?                 @map("drop_out_reason")
  studentOutcome       StudentOutcome[]
  studentComplaints    StudentComplaints[]
  clinicalCases        ClinicalScreeningInfo[]

  @@map("students")
}

model StudentOutcome {
  id                   String       @id @map("id")
  createdAt            DateTime     @default(now()) @map("created_at") @db.Timestamptz
  updatedAt            DateTime     @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  shamiriId            String?      @map("shamiri_id")
  student              Student?     @relation(fields: [shamiriId], references: [visibleId])
  timePoint            Int          @map("time_point")
  yearOfImplementation Int          @map("year_of_implementation") // might not be required anymore
  date                 DateTime?    @map("date") @db.Date
  condition            String       @map("condition")
  implementerId        String?      @map("implementer_id")
  implementer          Implementer? @relation(fields: [implementerId], references: [visibleId])
  phq1                 Int?         @map("phq_1")
  phq2                 Int?         @map("phq_2")
  phq3                 Int?         @map("phq_3")
  phq4                 Int?         @map("phq_4")
  phq5                 Int?         @map("phq_5")
  phq6                 Int?         @map("phq_6")
  phq7                 Int?         @map("phq_7")
  phq8                 Int?         @map("phq_8")
  phqFunctioning       Int?         @map("phq_functioning")
  gad1                 Int?         @map("gad_1")
  gad2                 Int?         @map("gad_2")
  gad3                 Int?         @map("gad_3")
  gad4                 Int?         @map("gad_4")
  gad5                 Int?         @map("gad_5")
  gad6                 Int?         @map("gad_6")
  gad7                 Int?         @map("gad_7")
  gadFunctioning       Int?         @map("gad_functioning")
  mspss1               Int?         @map("mspss_1")
  mspss2               Int?         @map("mspss_2")
  mspss3               Int?         @map("mspss_3")
  mspss4               Int?         @map("mspss_4")
  mspss5               Int?         @map("mspss_5")
  mspss6               Int?         @map("mspss_6")
  mspss7               Int?         @map("mspss_7")
  mspss8               Int?         @map("mspss_8")
  mspss9               Int?         @map("mspss_9")
  mspss10              Int?         @map("mspss_10")
  mspss11              Int?         @map("mspss_11")
  mspss12              Int?         @map("mspss_12")
  gq1                  Int?         @map("gq_1")
  gq2                  Int?         @map("gq_2")
  gq3                  Int?         @map("gq_3")
  gq4                  Int?         @map("gq_4")
  gq5                  Int?         @map("gq_5")
  gq6                  Int?         @map("gq_6")
  pcs1                 Int?         @map("pcs_1")
  pcs2                 Int?         @map("pcs_2")
  pcs3                 Int?         @map("pcs_3")
  pcs4                 Int?         @map("pcs_4")
  pcs5                 Int?         @map("pcs_5")
  pcs6                 Int?         @map("pcs_6")
  pcs7                 Int?         @map("pcs_7")
  pcs8                 Int?         @map("pcs_8")
  pcs9                 Int?         @map("pcs_9")
  pcs10                Int?         @map("pcs_10")
  pcs11                Int?         @map("pcs_11")
  pcs12                Int?         @map("pcs_12")
  pcs13                Int?         @map("pcs_13")
  pcs14                Int?         @map("pcs_14")
  pcs15                Int?         @map("pcs_15")
  pcs16                Int?         @map("pcs_16")
  pcs17                Int?         @map("pcs_17")
  pcs18                Int?         @map("pcs_18")
  pcs19                Int?         @map("pcs_19")
  pcs20                Int?         @map("pcs_20")
  pcs21                Int?         @map("pcs_21")
  pcs22                Int?         @map("pcs_22")
  pcs23                Int?         @map("pcs_23")
  pcs24                Int?         @map("pcs_24")
  pcr3                 Int?         @map("pcr_3")
  pcr5                 Int?         @map("pcr_5")
  pcr6                 Int?         @map("pcr_6")
  pcr8                 Int?         @map("pcr_8")
  pcr10                Int?         @map("pcr_10")
  pcr12                Int?         @map("pcr_12")
  pcr13                Int?         @map("pcr_13")
  pcr16                Int?         @map("pcr_16")
  pcr17                Int?         @map("pcr_17")
  pcr19                Int?         @map("pcr_19")
  pcr21                Int?         @map("pcr_21")
  pcr23                Int?         @map("pcr_23")
  personalityQ1        Int?         @map("personality_q1")
  personalityQ2        Int?         @map("personality_q2")
  personalityQ3        Int?         @map("personality_q3")
  personalityQ4        Int?         @map("personality_q4")
  personalityQ5        Int?         @map("personality_q5")
  personalityRQ1       Int?         @map("personality_rq1")
  personalityRQ4       Int?         @map("personality_rq4")
  swemwbs1             Int?         @map("swemwbs_1")
  swemwbs2             Int?         @map("swemwbs_2")
  swemwbs3             Int?         @map("swemwbs_3")
  swemwbs4             Int?         @map("swemwbs_4")
  swemwbs5             Int?         @map("swemwbs_5")
  swemwbs6             Int?         @map("swemwbs_6")
  swemwbs7             Int?         @map("swemwbs_7")
  pils1                Int?         @map("pils_1")
  pils2                Int?         @map("pils_2")
  pils3                Int?         @map("pils_3")
  pils4                Int?         @map("pils_4")
  pils5                Int?         @map("pils_5")
  pils6                Int?         @map("pils_6")
  pils7                Int?         @map("pils_7")
  pils8                Int?         @map("pils_8")
  pils9                Int?         @map("pils_9")
  pils10               Int?         @map("pils_10")
  pils11               Int?         @map("pils_11")
  pils12               Int?         @map("pils_12")
  epochE1              Int?         @map("epoch_e1")
  epochE2              Int?         @map("epoch_e2")
  epochE3              Int?         @map("epoch_e3")
  epochE4              Int?         @map("epoch_e4")
  epochP1              Int?         @map("epoch_p1")
  epochP2              Int?         @map("epoch_p2")
  epochP3              Int?         @map("epoch_p3")
  epochP4              Int?         @map("epoch_p4")
  epochO1              Int?         @map("epoch_o1")
  epochO2              Int?         @map("epoch_o2")
  epochO3              Int?         @map("epoch_o3")
  epochO4              Int?         @map("epoch_o4")
  epochC1              Int?         @map("epoch_c1")
  epochC2              Int?         @map("epoch_c2")
  epochC3              Int?         @map("epoch_c3")
  epochC4              Int?         @map("epoch_c4")
  epochH1              Int?         @map("epoch_h1")
  epochH2              Int?         @map("epoch_h2")
  epochH3              Int?         @map("epoch_h3")
  epochH4              Int?         @map("epoch_h4")
  ucla1                Int?         @map("ucla_1")
  ucla2                Int?         @map("ucla_2")
  ucla3                Int?         @map("ucla_3")
  ucla4                Int?         @map("ucla_4")
  ucla5                Int?         @map("ucla_5")
  ucla6                Int?         @map("ucla_6")
  ucla7                Int?         @map("ucla_7")
  ucla8                Int?         @map("ucla_8")
  pcsc1                Int?         @map("pcsc_1")
  pcsc2                Int?         @map("pcsc_2")
  pcsc3                Int?         @map("pcsc_3")
  pcsc4                Int?         @map("pcsc_4")
  pcsc5                Int?         @map("pcsc_5")
  pcsc6                Int?         @map("pcsc_6")
  pcsc7                Int?         @map("pcsc_7")
  pcsc8                Int?         @map("pcsc_8")
  scs1                 Int?         @map("scs_1")
  scs2                 Int?         @map("scs_2")
  scs3                 Int?         @map("scs_3")
  scs4                 Int?         @map("scs_4")
  scs5                 Int?         @map("scs_5")
  scs6                 Int?         @map("scs_6")
  sps1                 Int?         @map("sps_1")
  sps2                 Int?         @map("sps_2")
  sps3                 Int?         @map("sps_3")
  sps4                 Int?         @map("sps_4")
  sps5                 Int?         @map("sps_5")
  sps6                 Int?         @map("sps_6")
  sps7                 Int?         @map("sps_7")
  sps8                 Int?         @map("sps_8")
  sps9                 Int?         @map("sps_9")
  sps10                Int?         @map("sps_10")
  sps11                Int?         @map("sps_11")
  sps12                Int?         @map("sps_12")
  iptq1                Int?         @map("iptq_1")
  iptq2                Int?         @map("iptq_2")
  iptq3                Int?         @map("iptq_3")
  moc1                 Int?         @map("moc_1")
  moc2                 Int?         @map("moc_2")
  moc3                 Int?         @map("moc_3")
  moc4                 Int?         @map("moc_4")
  moc5                 Int?         @map("moc_5")
  moc6                 Int?         @map("moc_6")
  moc7                 Int?         @map("moc_7")
  moc8                 Int?         @map("moc_8")
  moc9                 Int?         @map("moc_9")
  moc10                Int?         @map("moc_10")
  fb1Accept            Int?         @map("fb1_accept")
  fb2Feas              Int?         @map("fb2_feas")

  @@map("student_outcomes")
}

/// Fellows are the lay-providers, group leaders of the Shamiri Intervention.
model Fellow {
  id                      String                     @id @db.VarChar(255)
  createdAt               DateTime                   @default(now()) @map("created_at")
  updatedAt               DateTime                   @updatedAt @map("updated_at")
  archivedAt              DateTime?                  @map("archived_at")
  visibleId               String                     @unique @map("visible_id") @db.VarChar(100)
  fellowName              String?                    @map("fellow_name") @db.VarChar(255)
  fellowEmail             String?                    @map("fellow_email") @db.VarChar(255)
  yearOfImplementation    Int?                       @map("year_of_implementation") // might not be required anymore
  mpesaName               String?                    @map("mpesa_name") @db.VarChar(255)
  mpesaNumber             String?                    @map("mpesa_number") @db.VarChar(255)
  idNumber                String?                    @map("id_number") @db.VarChar(255) // consider having this as required when we can establish 100% collection of this field, and probably encrypted at the db level
  cellNumber              String?                    @map("cell_number") @db.VarChar(255)
  county                  String?                    @map("county") @db.VarChar(255)
  subCounty               String?                    @map("sub_county") @db.VarChar(255)
  dateOfBirth             DateTime?                  @map("date_of_birth") @db.Date
  gender                  String?                    @map("gender")
  transferred             Boolean?                   @map("transferred")
  hubId                   String?                    @map("hub_id") @db.VarChar(255)
  hub                     Hub?                       @relation(fields: [hubId], references: [id])
  implementerId           String?                    @map("implementer_id") @db.VarChar(255)
  implementer             Implementer?               @relation(fields: [implementerId], references: [id])
  supervisorId            String?                    @map("supervisor_id") @db.VarChar(255)
  supervisor              Supervisor?                @relation(fields: [supervisorId], references: [id])
  droppedOut              Boolean?                   @map("dropped_out") // keeping this here for historical data that didn't track droppedOutDates
  droppedOutAt            DateTime?                  @map("dropped_out_at") @db.Timestamptz()
  dropOutReason           String?                    @map("drop_out_reason")
  students                Student[]
  fellowAttendances       FellowAttendance[]
  groupSessions           InterventionGroupSession[]
  fellowReportingNotes    FellowReportingNotes[]
  repaymentRequests       RepaymentRequest[]
  overallFellowEvaluation OverallFellowEvaluation[]
  fellowComplaints        FellowComplaints[]
  weeklyFellowRatings     WeeklyFellowRatings[]

  @@map("fellows")
}

/// FellowAttendance is a representation of the attendance of a fellow in a session. It is used to track the attendance of fellows in sessions but also track the session in the future.

model FellowAttendance {
  id                   Int                       @id @default(autoincrement())
  visibleId            String                    @unique @map("visible_id") @db.VarChar(100)
  createdAt            DateTime                  @default(now()) @map("created_at")
  updatedAt            DateTime                  @updatedAt @map("updated_at")
  fellowId             String                    @map("fellow_id") @db.VarChar(255)
  fellow               Fellow                    @relation(fields: [fellowId], references: [id])
  sessionNumber        Int                       @map("session_number")
  sessionDate          DateTime                  @map("session_date")
  yearOfImplementation Int                       @map("year_of_implementation") // might not be needed
  schoolId             String                    @map("school_id") @db.VarChar(255)
  school               School                    @relation(fields: [schoolId], references: [id])
  supervisorId         String                    @map("supervisor_id") @db.VarChar(255)
  supervisor           Supervisor                @relation(fields: [supervisorId], references: [id])
  attended             Boolean?                  @map("attended")
  absenceReason        String?                   @map("absence_reason")
  paymentInitiated     Boolean?                  @map("payment_initiated")
  groupSessionId       String?                   @map("group_session_id") @db.VarChar(255)
  groupSession         InterventionGroupSession? @relation(fields: [groupSessionId], references: [id])

  @@map("fellow_attendances")
}

model Supervisor {
  id                        String                      @id @db.VarChar(255)
  createdAt                 DateTime                    @default(now()) @map("created_at")
  updatedAt                 DateTime                    @updatedAt @map("updated_at")
  archivedAt                DateTime?                   @map("archived_at")
  hubId                     String?                     @map("hub_id") @db.VarChar(255)
  hub                       Hub?                        @relation(fields: [hubId], references: [id])
  visibleId                 String                      @unique @map("visible_id") @db.VarChar(100)
  supervisorName            String?                     @map("supervisor_name") @db.VarChar(255)
  supervisorEmail           String?                     @unique @map("supervisor_email") @db.VarChar(255)
  idNumber                  String?                     @map("id_number") @db.VarChar(255)
  cellNumber                String?                     @map("cell_number") @db.VarChar(255)
  mpesaName                 String?                     @map("mpesa_name") @db.VarChar(255)
  mpesaNumber               String?                     @map("mpesa_number") @db.VarChar(20)
  implementerId             String                      @map("implementer_id") @db.VarChar(255)
  implementer               Implementer?                @relation(fields: [implementerId], references: [id])
  county                    String?                     @map("county") @db.VarChar(255)
  subCounty                 String?                     @map("sub_county") @db.VarChar(255)
  bankName                  String?                     @map("bank_name") @db.VarChar(255)
  bankBranch                String?                     @map("bank_branch") @db.VarChar(255)
  bankAccountName           String?                     @map("bank_account_name") @db.VarChar(255)
  bankAccountNumber         String?                     @map("bank_account_number") @db.VarChar(255)
  kra                       String?                     @map("kra") @db.VarChar(255)
  nhif                      String?                     @map("nhif") @db.VarChar(255)
  nssf                      String?                     @map("nssf") @db.VarChar(255)
  dateOfBirth               DateTime?                   @map("date_of_birth") @db.Date
  gender                    String?                     @db.VarChar(10)
  trainingLevel             String?                     @map("training_level") @db.VarChar(255)
  droppedOut                Boolean?                    @map("dropped_out")
  assignedSchoolId          String?                     @map("assigned_school_id") @db.VarChar(255)
  assignedSchool            School?                     @relation(fields: [assignedSchoolId], references: [id])
  fellows                   Fellow[]
  students                  Student[]
  fellowAttendances         FellowAttendance[]
  sessionRatings            InterventionSessionRating[]
  sessionNotes              InterventionSessionNote[]
  reimbursementRequests     ReimbursementRequest[]
  StudentComplaints         StudentComplaints[]
  fellowReportingNotes      FellowReportingNotes[]
  clinicalScreeningCases    ClinicalScreeningInfo[]
  referredToMeClinicalCases ClinicalScreeningInfo[]     @relation("referredtocases")
  repaymentRequests         RepaymentRequest[]
  overallFellowEvaluation   OverallFellowEvaluation[]
  fellowComplaints          FellowComplaints[]
  weeklyFellowRatings       WeeklyFellowRatings[]

  @@map("supervisors")
}

model School {
  id                          String                     @id @db.VarChar(255)
  createdAt                   DateTime                   @default(now()) @map("created_at")
  updatedAt                   DateTime                   @updatedAt @map("updated_at")
  archivedAt                  DateTime?                  @map("archived_at")
  schoolName                  String                     @map("school_name") @db.VarChar(255) // e.g. Garden Estate
  schoolType                  String?                    @map("school_type") @db.VarChar(255)
  schoolEmail                 String?                    @map("school_email") @db.VarChar(255)
  schoolCounty                String?                    @map("school_county") @db.VarChar(255) // e.g. Makueni
  schoolDemographics          String?                    @map("school_demographics") @db.VarChar(255) // e.g. Mixed
  visibleId                   String                     @unique @map("visible_id") @db.VarChar(100) // e.g. T2PS_School_6
  implementerId               String?                    @map("implementer_id") @db.VarChar(255)
  implementer                 Implementer?               @relation(fields: [implementerId], references: [id])
  hubId                       String?                    @map("hub_id") @db.VarChar(255)
  hub                         Hub?                       @relation(fields: [hubId], references: [id])
  pointPersonName             String?                    @map("point_person_name") @db.VarChar(255)
  pointPersonId               String?                    @map("point_person_id") @db.VarChar(255)
  pointPersonPhone            String?                    @map("point_person_phone") @db.VarChar(255)
  pointPersonEmail            String?                    @map("point_person_email") @db.VarChar(255)
  numbersExpected             Int?                       @map("numbers_expected") // e.g. 700
  boardingDay                 String?                    @map("boarding_day") @db.VarChar(255) // e.g. Day and boarding
  longitude                   Float?                     @map("longitude")
  latitude                    Float?                     @map("latitude")
  droppedOut                  Boolean?                   @map("dropped_out")
  dropoutReason               String?                    @map("dropout_reason")
  preSessionDate              DateTime?                  @map("pre_session_date")
  session1Date                DateTime?                  @map("session_1_date")
  session2Date                DateTime?                  @map("session_2_date")
  session3Date                DateTime?                  @map("session_3_date")
  session4Date                DateTime?                  @map("session_4_date")
  clinicalFollowup1Date       DateTime?                  @map("clinical_followup_1_date")
  clinicalFollowup2Date       DateTime?                  @map("clinical_followup_2_date")
  clinicalFollowup3Date       DateTime?                  @map("clinical_followup_3_date")
  clinicalFollowup4Date       DateTime?                  @map("clinical_followup_4_date")
  clinicalFollowup5Date       DateTime?                  @map("clinical_followup_5_date")
  clinicalFollowup6Date       DateTime?                  @map("clinical_followup_6_date")
  clinicalFollowup7Date       DateTime?                  @map("clinical_followup_7_date")
  clinicalFollowup8Date       DateTime?                  @map("clinical_followup_8_date")
  dataCollectionFollowup1Date DateTime?                  @map("data_collection_followup_1_date")
  students                    Student[]
  fellowAttendances           FellowAttendance[]
  interventionSessions        InterventionSession[]
  supervisors                 Supervisor[]
  interventionGroupSession    InterventionGroupSession[]

  @@map("schools")
}

model Hub {
  id                    String                 @id @db.VarChar(255)
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  archivedAt            DateTime?              @map("archived_at")
  visibleId             String                 @unique @map("visible_id") @db.VarChar(100)
  hubName               String                 @map("hub_name") @db.VarChar(255)
  implementerId         String                 @map("implementer_id") @db.VarChar(255) // this might not be needed anymore now that we have project
  implementer           Implementer            @relation(fields: [implementerId], references: [id])
  // clinical_ops_supervisor_id // TODO: add after defining clinical workflows
  fellows               Fellow[]
  supervisors           Supervisor[]
  schools               School[]
  reimbursementRequests ReimbursementRequest[]
  repaymentRequests     RepaymentRequest[]
  coordinators          HubCoordinator[]
  projectId             String?                @db.VarChar(100)
  project               Projects?              @relation(fields: [projectId], references: [id])

  @@map("hubs")
}

model HubCoordinator {
  id                    String                 @id @db.VarChar(255)
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  archivedAt            DateTime?              @map("archived_at")
  visibleId             String                 @unique @map("visible_id") @db.VarChar(100) // e.g. 23_HC_01
  coordinatorName       String                 @map("coordinator_name") @db.VarChar(255) // e.g. Beverly
  coordinatorEmail      String?                @unique @map("coordinator_email") @db.VarChar(255) // e.g. nalietujoy@gmail.com
  idNumber              String?                @map("id_number") @db.VarChar(255)
  cellNumber            String?                @map("cell_number") @db.VarChar(255)
  mpesaNumber           String?                @map("mpesa_number") @db.VarChar(255)
  implementerId         String                 @map("implementer_id") @db.VarChar(255)
  implementer           Implementer            @relation(fields: [implementerId], references: [id])
  county                String?                @map("county") @db.VarChar(255)
  subCounty             String?                @map("sub_county") @db.VarChar(255)
  bankName              String?                @map("bank_name") @db.VarChar(255)
  bankBranch            String?                @map("bank_branch") @db.VarChar(255)
  bankAccountNumber     String?                @map("bank_account_number") @db.VarChar(255)
  bankAccountName       String?                @map("bank_account_name") @db.VarChar(255)
  kra                   String?                @map("kra") @db.VarChar(255)
  nhif                  String?                @map("nhif") @db.VarChar(255)
  dateOfBirth           DateTime?              @map("date_of_birth") @db.Date
  gender                String?                @db.VarChar(10)
  trainingLevel         String?                @map("training_level") @db.VarChar(255)
  droppedOut            Boolean?               @map("dropped_out")
  assignedHubId         String?                @map("assigned_hub_id") @db.VarChar(255)
  assignedHub           Hub?                   @relation(fields: [assignedHubId], references: [id])
  reimbursementRequests ReimbursementRequest[]

  @@map("hub_coordinators")
}

/// Intervention sessions represent the school-wide intervention event happening
model InterventionSession {
  id                   String                      @id @db.VarChar(255)
  createdAt            DateTime                    @default(now()) @map("created_at")
  updatedAt            DateTime                    @updatedAt @map("updated_at")
  archivedAt           DateTime?                   @map("archived_at")
  sessionDate          DateTime                    @map("session_date")
  sessionName          String                      @map("session_name") @db.VarChar(255)
  sessionType          String                      @map("session_type") @db.VarChar(255) // e.g. s0, s1, s2, s3, s4, fu1, fu2, ..., fu8
  schoolId             String                      @map("school_id") @db.VarChar(255)
  school               School                      @relation(fields: [schoolId], references: [id])
  occurred             Boolean
  occurringAt          DateTime?                   @map("occurring_at") @db.Timestamptz()
  yearOfImplementation Int                         @map("year_of_implementation") // might not be needed anymore
  groupSessions        InterventionGroupSession[]
  sessionRatings       InterventionSessionRating[]
  sessionNotes         InterventionSessionNote[]

  @@unique([schoolId, sessionType], name: "interventionBySchoolIdAndSessionType")
  @@map("intervention_sessions")
}

model InterventionSessionRating {
  id                    String              @id @db.VarChar(255)
  createdAt             DateTime            @default(now()) @map("created_at")
  updatedAt             DateTime            @updatedAt @map("updated_at")
  archivedAt            DateTime?           @map("archived_at")
  sessionId             String              @map("session_id") @db.VarChar(255)
  session               InterventionSession @relation(fields: [sessionId], references: [id])
  supervisorId          String              @map("supervisor_id") @db.VarChar(255)
  supervisor            Supervisor          @relation(fields: [supervisorId], references: [id])
  studentBehaviorRating Int?                @map("student_behavior_rating")
  adminSupportRating    Int?                @map("admin_support_rating")
  workloadRating        Int?                @map("workload_rating")

  @@unique([sessionId, supervisorId], name: "ratingBySessionIdAndSupervisorId")
  @@map("intervention_session_ratings")
}

model InterventionSessionNote {
  id           Int                 @id @default(autoincrement())
  createdAt    DateTime            @default(now()) @map("created_at")
  updatedAt    DateTime            @updatedAt @map("updated_at")
  archivedAt   DateTime?           @map("archived_at")
  sessionId    String              @map("session_id") @db.VarChar(255)
  session      InterventionSession @relation(fields: [sessionId], references: [id])
  supervisorId String              @map("supervisor_id") @db.VarChar(255)
  supervisor   Supervisor          @relation(fields: [supervisorId], references: [id])
  kind         String              @db.VarChar(255) /// positive-highlights, reported-challenges, recommendations, added-notes
  content      String              @db.Text

  @@map("intervention_session_notes")
}

/// Intervention group sessions are group sessions where the Shamiri Intervention is delivered to high school students by run by fellows (a group leader)
model InterventionGroupSession {
  id                String              @id @db.VarChar(255)
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")
  archivedAt        DateTime?           @map("archived_at")
  groupName         String              @map("group_name") @db.VarChar(100)
  leaderId          String?             @map("leader_id") @db.VarChar(255)
  leader            Fellow?             @relation(fields: [leaderId], references: [id])
  sessionId         String              @map("session_id") @db.VarChar(255)
  session           InterventionSession @relation(fields: [sessionId], references: [id])
  schoolId          String?             @map("school_id") // make this mandatory later on
  school            School?             @relation(fields: [schoolId], references: [id])
  fellowAttendances FellowAttendance[]
  repaymentRequests RepaymentRequest[]

  @@map("intervention_group_sessions")
}

model ReimbursementRequest {
  id               String          @id @db.VarChar(255)
  createdAt        DateTime        @default(now()) @map("created_at")
  updatedAt        DateTime        @updatedAt @map("updated_at")
  archivedAt       DateTime?       @map("archived_at")
  supervisorId     String          @map("supervisor_id") @db.VarChar(255)
  supervisor       Supervisor      @relation(fields: [supervisorId], references: [id])
  hubId            String          @map("hub_id") @db.VarChar(255)
  hub              Hub             @relation(fields: [hubId], references: [id])
  hubCoordinatorId String?         @map("hub_coordinator_id") @db.VarChar(255)
  hubCoordinator   HubCoordinator? @relation(fields: [hubCoordinatorId], references: [id])
  incurredAt       DateTime        @map("incurred_at") @db.Timestamptz()
  amount           Int
  currency         String          @default("KES") @db.VarChar(10)
  kind             String          @db.VarChar(255) // e.g. travel, internet, airtime
  status           String          @default("pending") @db.VarChar(100) // e.g. pending, approved, canceled, rejected
  details          Json // e.g. { "subtype": "materials", "receipt_link": "google-drive..." }
  mpesaName        String          @map("mpesa_name") @db.VarChar(255)
  mpesaNumber      String          @map("mpesa_number") @db.VarChar(20)

  @@map("reimbursement_requests")
}

model RepaymentRequest {
  id             String                   @id @default(cuid())
  createdAt      DateTime                 @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt      DateTime                 @updatedAt @map("updated_at") @db.Timestamptz()
  supervisorId   String                   @map("supervisor_id") @db.VarChar(255)
  supervisor     Supervisor               @relation(fields: [supervisorId], references: [id])
  fellowId       String                   @map("fellow_id") @db.VarChar(255)
  fellow         Fellow                   @relation(fields: [fellowId], references: [id])
  hubId          String                   @map("hub_id") @db.VarChar(255)
  hub            Hub                      @relation(fields: [hubId], references: [id])
  groupSessionId String                   @map("group_session_id") @db.VarChar(255)
  groupSession   InterventionGroupSession @relation(fields: [groupSessionId], references: [id])

  @@map("repayment_requests")
}

model StudentComplaints {
  id           String     @id @default(cuid())
  createdAt    DateTime   @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt    DateTime   @updatedAt @map("updated_at") @db.Timestamptz()
  supervisorId String     @map("supervisor_id") @db.VarChar(255)
  supervisor   Supervisor @relation(fields: [supervisorId], references: [id])
  studentId    String     @map("student_id") @db.VarChar(255)
  student      Student    @relation(fields: [studentId], references: [id])
  complaint    String

  @@map("student_complaints")
}

model FellowReportingNotes {
  id           String     @id @default(cuid())
  createdAt    DateTime   @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt    DateTime   @updatedAt @map("updated_at") @db.Timestamptz()
  supervisorId String     @map("supervisor_id") @db.VarChar(255)
  supervisor   Supervisor @relation(fields: [supervisorId], references: [id])
  fellowId     String     @map("fellow_id") @db.VarChar(255)
  fellow       Fellow     @relation(fields: [fellowId], references: [id])
  notes        String     @db.Text()

  @@map("fellow_reporting_notes")
}

model OverallFellowEvaluation {
  id                       String     @id @default(cuid())
  createdAt                DateTime   @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt                DateTime   @updatedAt @map("updated_at")
  archivedAt               DateTime?  @map("archived_at") @db.Timestamptz()
  supervisorId             String     @map("supervisor_id") @db.VarChar(255)
  supervisor               Supervisor @relation(fields: [supervisorId], references: [id])
  fellowId                 String     @map("fellow_id") @db.VarChar(255)
  fellow                   Fellow     @relation(fields: [fellowId], references: [id])
  fellowBehaviourNotes     String     @map("fellow_behaviour_notes") @db.Text()
  programDeliveryNotes     String     @map("program_delivery_notes") @db.Text()
  dressingAndGroomingNotes String     @map("dressing_and_grooming_notes") @db.Text()
  attendanceNotes          String     @map("attendance_notes") @db.Text()

  @@map("overall_fellow_evaluations")
}

enum caseStatusOptions {
  Active
  Terminated
  FollowUp
  Referred
}

enum riskStatusOptions {
  No
  Low
  Medium
  High
}

enum referralStatusOptions {
  Approved
  Declined
  Pending
}

model ClinicalScreeningInfo {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz()
  // updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz()
  studentId String   @map("student_id") @db.VarChar(255)
  student   Student  @relation(fields: [studentId], references: [id])

  caseStatus caseStatusOptions @map("case_status")
  riskStatus riskStatusOptions @map("risk_status")
  schoolId   String            @map("school_id") @db.VarChar(255)

  currentSupervisorId    String      @map("current_supervisor_id") @db.VarChar(255)
  currentSupervisor      Supervisor  @relation(fields: [currentSupervisorId], references: [id])
  referredToSupervisorId String?     @map("referredTo_supervisor_id") @db.VarChar(255)
  referredToSupervisor   Supervisor? @relation("referredtocases", fields: [referredToSupervisorId], references: [id])

  acceptCase     Boolean                @default(false) @map("accept_case")
  referralStatus referralStatusOptions? @map("referral_status")

  sessions                              ClinicalSessionAttendance[]
  generalPresentingIssues               String?                     @map("general_presenting_issues") @db.VarChar(255)
  generalPresentingIssuesOtherSpecified String?                     @map("general_presenting_issues_other_specified") @db.Text()
  emergencyPresentingIssues             Json?                       @map("emergency_presenting_issues") @db.Json()
  referredFrom                          String?                     @map("referred_from") @db.VarChar(255)
  referredFromSpecified                 String?                     @map("referred_from_specified") @db.VarChar(255)
  referredTo                            String?                     @map("referred_to") @db.VarChar(255)
  referredToSpecified                   String?                     @map("referred_to_specified") @db.VarChar(255)
  referralNotes                         String?                     @map("referral_notes") @db.Text()
  caseTransferTrail                     ClinicalCaseTransferTrail[]
  consultingClinicalExpert              ClinicalExpertCaseNotes[]
  progressNotes                         String?                     @map("progress_notes") @db.VarChar(255) // link to a google doc hub/school/supervisor/cases/progress_notes
  treatmentPlan                         String?                     @map("treatment_plan") @db.VarChar(255) // upload a link to a google doc hub/school/supervisor/cases/treatment_plan
  caseReport                            String?                     @map("case_report") @db.VarChar(255) // upload a link to a google doc hub/school/supervisor/cases/case_report
  flagged                               Boolean                     @default(false)

  initialCaseHistoryId      String? @map("initial_case_history_id") @db.VarChar(255)
  initialCaseHistoryOwnerId String? @map("initial_case_history_owner_id") @db.VarChar(255)

  @@map("clinical_screening_info")
}

model ClinicalCaseTransferTrail {
  id             String                 @id @default(cuid())
  createdAt      DateTime               @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt      DateTime               @updatedAt @map("updated_at")
  date           DateTime               @default(now()) @map("date") @db.Timestamptz()
  from           String                 @map("from") @db.VarChar(255)
  fromRole       String                 @map("from_role") @db.VarChar(255)
  to             String                 @map("to") @db.VarChar(255)
  toRole         String                 @map("to_role") @db.VarChar(255)
  caseId         String
  case           ClinicalScreeningInfo? @relation(fields: [caseId], references: [id])
  referralStatus referralStatusOptions? @map("referral_status")

  @@map("clinical_case_transfer_trail")
}

model ClinicalExpertCaseNotes {
  id        String                @id @default(cuid())
  createdAt DateTime              @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt DateTime              @updatedAt @map("updated_at")
  name      String                @map("name") @db.VarChar(255)
  comment   String                @map("comment") @db.Text()
  caseId    String
  case      ClinicalScreeningInfo @relation(fields: [caseId], references: [id])

  @@map("clinical_expert_case_notes")
}

model ClinicalSessionAttendance {
  id           String                @id @default(cuid())
  createdAt    DateTime              @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt    DateTime              @updatedAt @map("updated_at") @db.Timestamptz()
  date         DateTime              @default(now()) @map("date") @db.Timestamptz()
  supervisorId String                @map("supervisor_id") @db.VarChar(255)
  session      String                @map("session") @db.VarChar(255)
  caseId       String
  case         ClinicalScreeningInfo @relation(fields: [caseId], references: [id])

  @@map("clinical_session_attendance")
}

model FellowComplaints {
  id           String     @id @default(cuid())
  createdAt    DateTime   @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt    DateTime   @updatedAt @map("updated_at")
  complaint    String     @db.Text()
  supervisorId String     @map("supervisor_id") @db.VarChar(255)
  supervisor   Supervisor @relation(fields: [supervisorId], references: [id])
  fellowId     String     @map("fellow_id") @db.VarChar(255)
  fellow       Fellow     @relation(fields: [fellowId], references: [id])

  @@map("fellow_complaints")
}

model WeeklyFellowRatings {
  id                       String     @id @default(cuid())
  createdAt                DateTime   @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt                DateTime   @updatedAt @map("updated_at") @db.Timestamptz()
  week                     DateTime   @db.Date // stores the week of the evaluation
  behaviourNotes           String     @map("behaviour_notes") @db.Text()
  programDeliveryNotes     String     @map("program_delivery_notes") @db.Text()
  dressingAndGroomingNotes String     @map("dressing_and_grooming_notes") @db.Text()
  attendanceNotes          String     @map("attendance_notes") @db.Text()
  fellowId                 String     @map("fellow_id") @db.VarChar(255)
  fellow                   Fellow     @relation(fields: [fellowId], references: [id])
  supervisorId             String     @map("supervisor_id") @db.Text()
  supervisor               Supervisor @relation(fields: [supervisorId], references: [id])

  @@map("weekly_fellow_ratings")
}

// this model will force us to actually think about super users if we want to track who created a record
model Projects {
  id                 String        @id @default(cuid())
  createdAt          DateTime      @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt          DateTime      @updatedAt @map("updated_at")
  visibleId          String        @unique @map("visible_id") @db.VarChar(255)
  name               String        @db.VarChar(100)
  projectLead        String?       @map("project_lead") @db.VarChar(255) // consider if this is necessary
  implementerId      String        @map("implementer_id") @db.VarChar(255)
  implementer        Implementer[] //prisma implicit join to create an association table
  funder             String?       @db.VarChar(255) // additional info required on what we need to do with this field
  budget             Int?
  phase              Int?
  estimatedStartDate DateTime?     @map("estimated_start_date") @db.Date
  estimatedEndDate   DateTime?     @map("estimated_end_date") @db.Date
  actualStartDate    DateTime?     @map("actual_start_date") @db.Date
  actualEndDate      DateTime?     @map("actual_end_date") @db.Date
  hub                Hub[]

  @@map("projects")
}
